<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>日参省乎己</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="日参省乎己">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="日参省乎己">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="日参省乎己">
  
    <link rel="alternate" href="/atom.xml" title="日参省乎己" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">日参省乎己</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-for_each和函数对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/12/02/for_each和函数对象/" class="article-date">
  <time datetime="2023-12-02T11:45:04.468Z" itemprop="datePublished">2023-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="for-each和函数对象"><a href="#for-each和函数对象" class="headerlink" title="for_each和函数对象"></a>for_each和函数对象</h1><h3 id="1，for-each"><a href="#1，for-each" class="headerlink" title="1，for_each"></a>1，for_each</h3><p>std::for_each 算法函数主要用于遍历  容器中的每个元素，并将每个元素传递给函数对象 <code>MyFunctor</code> 的 <code>operator()</code> 成员函数进行处理(如下例所示)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;int&gt; numbers = &#123;1, 2, 3, 4, 5&#125;;</span><br><span class="line">std::for_each(numbers.begin(), numbers.end(), MyFunctor());</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct MyFunctor &#123;</span><br><span class="line">    void operator()(int value) const &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Value: &quot; &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这儿for_each遍历每个元素，把每个元素当作第三个函数对象MyFunctor的参数。所以以上如果Lambda表达是来写的话，就如下所示了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;int&gt; numbers = &#123;1, 2, 3, 4, 5&#125;;</span><br><span class="line">std::for_each(numbers.begin(), numbers.end(), [](int value) &#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;Value: &quot; &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这儿(int value)这个参数定义很重要，表示for_each里面便利的每个元素。</p>
<h3 id="2，函数对象"><a href="#2，函数对象" class="headerlink" title="2，函数对象"></a>2，函数对象</h3><p>函数对象（Function Object）是一个类对象，它可以像函数一样被调用。函数对象重载了圆括号运算符 <code>()</code>，使得对象可以被当作函数来调用，并执行特定的操作。</p>
<p>函数对象可以用作算法函数的参数，例如 <code>std::for_each</code>、<code>std::transform</code>、<code>std::sort</code> 等。通过传递函数对象作为参数，算法函数可以在每个元素上执行自定义的操作或进行其他定制行为。</p>
<p>函数对象可以是一个普通的类，也可以是一个类的实例（对象）。在函数对象的类定义中，你需要定义一个公共的 <code>operator()</code> 成员函数，该成员函数定义了函数对象的行为。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2023/12/02/for_each和函数对象/" data-id="clpnzt0jf0000bcccadvlxvuc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-C#调用 C和C++dll的方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/10/C#调用 C和C++dll的方法/" class="article-date">
  <time datetime="2018-09-10T10:23:59.000Z" itemprop="datePublished">2018-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/10/C#调用 C和C++dll的方法/">C#调用 C/C++dll的方法：</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一，如果dll里面很简单，没有指针，结构体，数组的话，在C#里面直接使用dll就行了。 使用方法如下： 1，把dll放到exe的文件夹下面。</p>
<p>2，把dll里面的函数，在C#使用的地方，在声明一遍。如下 C++的DLL里面的函数： int init_usb_interface(int argpList);</p>
<p>C#里面要如下定义 [DllImport(“win_usb.dll”, EntryPoint = “init_usb_interface”, CallingConvention = CallingConvention.Cdecl)] public static extern int init_usb_interface(int win);</p>
<p>3，C#里面直接调用该函数，就可以了。</p>
<p>二，如果用C/C++dll的函数里面有指针参数的时候，需要用到ref，这个关键字。 还有参数为结构体的，还有二维数组，可以参考下面的例子。 如果还需要回调函数的话，就请查看网上资料了，就查关键字，c# c++ dll 回调函数</p>
<p>1，如果dll本身有头文件，就要把Dll头文件里面的定义，在C#里面定义一下。</p>
<p>2，#define C++里面 #define    MAX_USB_HUB_NUM    16</p>
<p>C#里面<br>const int MAX_USB_HUB_NUM = 16;<br>3，enum C++里面： typedef enum { USB_ERR_GET_HUB_HANDLER = -1,    /<em> Fail to get hadle to usb hubs </em>/ }USB_IF_ERROR_CODE;</p>
<p>C#里面： public enum USB_IF_ERROR_CODE { USB_ERR_GET_HUB_HANDLER = -1, /<em> Fail to get hadle to usb hubs </em>/ }</p>
<p>4，结构体，结构体里面包含二维数组。 C++里面： typedef struct { int num; char volumn[MAX_USB_STORAGE_NUM][VOLUMN_NAME_LENGTH]; }WIN_USB_STORAGE_LIST;</p>
<p>C#里面： [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi, Pack = 1)] public struct WIN_USB_STORAGE_LIST { public int num;</p>
<pre><code>    [MarshalAs(UnmanagedType.ByValArray, SizeConst = MAX_USB_STORAGE_NUM, ArraySubType = System.Runtime.InteropServices.UnmanagedType.ByValTStr)]
    public WV_volumn[] volumn;
};

[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi, Pack = 1)]
public struct WV_volumn
{
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = VOLUMN_NAME_LENGTH)]
    public string volumn;
}
</code></pre><p>注意这儿char 使用string 来代替的，下面也有用byte类型来代替</p>
<p>5，函数声明调用 C++的DLL里面的函数： int init_usb_interface(WIN_USB_HUB_LIST *argpList);</p>
<p>C#里面要如下定义 [DllImport(“win_usb.dll”, EntryPoint = “init_usb_interface”, CallingConvention = CallingConvention.Cdecl)] public static extern int init_usb_interface([In, Out] ref WIN_USB_HUB_LIST win);</p>
<p>来一个复杂的： C++的DLL里面的函数： int write_usb_device(unsigned char <em>argpPath, unsigned int offset, void </em>argpInBuf, unsigned long argInBufSize);</p>
<p>C#里面的定义： [DllImport(“win_usb.dll”, EntryPoint = “write_usb_device”, CallingConvention = CallingConvention.Cdecl)] public static extern int write_usb_device(string argpPath, int offset, ref byte argpInBuf, int argInBufSize); 这个argpInBuf，就没有用string来定义，因为这个函数的特殊用法导致用string的时候，里面的内容有一些不正确。 只能用纯字节的指针来调用。 这个时候，C#里面调用这个函数的时候 argpInBuf 的定义如下： byte[] bBuffer = bBuffer = new byte[nFileLength];</p>
<p>函数调用如下： int ret = write_usb_device(dev.dev[i].devPath, 0, ref bBuffer[0], nFileLength); 注意bBuffer[0]，里面的0一定要加否则，会编译出错。</p>
<p>托管和非托管的概念 托管代码（Managed Code）实际上就是中间语言（IL）代码。代码编写完毕后进行编译，此时编译器把代码编译成中间语言（IL），而不是能直接在你的电脑上运行的机器码。程序集（Assembly）的文件负责封装中间语言，程序集中包含了描述所创建的方法、类以及属性的所有元数据。 托管代码在公共语言运行库（CLR）中运行。这个运行库给运行代码提供了多种服务，通常来说，公共语言运行库可以加载和验证程序集，并以此来保证中间语言的正确性。当某些方法被调用时，公共语言运行库把具体的方法编译成适合本地计算机运行的机器码，并且将编译好的机器码缓存起来，以备下次调用时使用。这个过程就是即时编译。  注意：程序实际上是被“托管”在公共语言运行库中。随着程序集的运行，公共语言运行库会持续地提供各种服务，例如内存管理、安全管理、线程管理等等。 总结：托管代码（Managed Code）是由公共语言运行库（CLR）执行的代码，而不是由操作系统直接执行。托管代码也可以调用CLR的运行库服务和功能，比如GC、类型检查、安全支持等等。这些服务和功能提供独立与开发语言的、统一的Managed Code应用程序行为。</p>
<p>非托管代码（Unmanaged Code）是指直接编译成目标计算机的机器码，这些代码只能运行在编译出这些代码的计算机上，或者是其他相同处理器或者几乎一样处理器的计算机上。  非托管代码不能享受公共语言运行库所提供的一些服务，例如内存管理、安全管理等。 如果非托管代码需要进行内存管理等服务，就必须显式地调用操作系统的接口，通常非托管代码调用Windows SDK所提供的API来实现内存管理。 非托管程序也可以通过调用COM接口来获取操作系统服务。 注意：C#跟Visual Studio平台的其他编程语言不一样的是，C#可以创建托管程序与非托管程序。当创建的项目选择名字以MFC，ATL或者Win32开头的项目类型，那么这个项目所产生的就是非托管程序。  总结：非托管代码（Unmanaged Code）不由CLR公共语言运行库执行，而是由操作系统直接执行的代码。</p>
<p>托管的，是不需要自己释放资源的，非托管的是需要自己释放资源的 所以，C/C++都是非托管的，C#是一般托管的，C#里面也有非托管的方式，一般用的比较少。</p>
<p>托管和非托管之间混合编程的时候，最好使用dll。 也可以用调用 COM 对象上的接口方法</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/10/C#调用 C和C++dll的方法/" data-id="cjlwaoucr0000bcccx9uiq2ci" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c-c-c/">c,c++,c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dll/">dll</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-传感器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/10/传感器/" class="article-date">
  <time datetime="2018-09-10T10:23:59.000Z" itemprop="datePublished">2018-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/10/传感器/">传感器的考虑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>嵌入式开发的时候，增加传感器是一个非常常见的事情，当增加一个传感器需要考虑下面事情。<br>  1，该传感器是什么接口进行通讯（串口？GPIO，USB？）<br>  2，使用什么方式进行对该传感器取得值（轮寻？还是中断？）<br>  3，该传感器取值的时候，抖动间隔时间，和抖动次数 4，该传感器的选通周期是多少</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/10/传感器/" data-id="cjlwaoucx0001bccc04yol60y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/传感器/">传感器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-项目问题总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/06/项目问题总结/" class="article-date">
  <time datetime="2018-09-06T10:23:59.000Z" itemprop="datePublished">2018-09-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/06/项目问题总结/">项目问题总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>项目问题从先后顺序来看主要分为下面三个阶段<br>1，项目评估启动<br>2，设计开发<br>3，发行</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/06/项目问题总结/" data-id="cjlwaoud20003bccc1km2x0ik" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/问题/">问题</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目/">项目</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/10/排序/" class="article-date">
  <time datetime="2018-07-10T10:23:59.000Z" itemprop="datePublished">2018-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/10/排序/">monogodb 排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Nodejs Monk来连接DB的时候，查询排序的写法：<br>（<a href="https://stackoverflow.com/questions/19954916/monk-sorting-with-limit-option）" target="_blank" rel="noopener">https://stackoverflow.com/questions/19954916/monk-sorting-with-limit-option）</a></p>
<p>sales.find({},{sort: {ctrctEndTime:1}},function(e,docs){ }</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/10/排序/" data-id="cjlwaoud00002bcccicyiq04h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Monk/">Monk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/排序/">排序</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post--nodejs随笔" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/08/-nodejs随笔/" class="article-date">
  <time datetime="2018-07-08T14:46:47.000Z" itemprop="datePublished">2018-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/08/-nodejs随笔/">nodejs随笔</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一,安装express的时候出现以下问题<br>解决方法：<br>1.通过config命令<br>$ npm config set registry <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a><br>$ npm info underscore （如果上面配置正确这个命令会有字符串response）<br>•    1<br>•    2<br>2.命令行指定<br>$ npm –registry <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a> info underscore<br>•    1<br>3.编辑 ~/.npmrc 加入下面内容<br>$ registry = <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></p>
<p><a href="http://blog.csdn.net/yypsober/article/details/51906616" target="_blank" rel="noopener">http://blog.csdn.net/yypsober/article/details/51906616</a></p>
<p>二，express 安装环境变量<br>现在已经有express<br>express命令安装在全局才起作用!<br>所以express安装的时候要用 npm install express -g<br>键入:express myapp (myapp是随意起的工程名称)<br>你会发现多了一个 C:\Program Files\nodejs\myapp 目录<br>默认情况下：里会自动创建</p>
<p>这几个文件，不做解释，相信有过开发经验的同学都能一眼明了。<br>复制node_modules到myapp下面</p>
<p>设置环境变量<br>、进入环境变量对话框，在系统变量下新建”NODE_PATH”，输入”d:\node\ node_modules“。（ps：这一步相当关键。）<br>2014.4.19新增：由于改变了module的默认地址，所以上面的用户变量都要跟着改变一下（用户变量”PATH”修改为“d:\node\”）</p>
<p>安装express</p>
<ol>
<li></li>
<li><p>在命令行中执行 “npm install -g express”等待下载并且自动完成安装。测试express完成安装的一个方法就是查看其版本号，执行命令 “express -V”正常情况下回输出版本号如图，但有遇到不正常情况的，会提示“express不是内部或外部命令”，这样问题就来了，这是什么原因呢？</p>
</li>
<li><p>5<br>有两种可能：①在第二步安装node是没有添加环境变量，这种情况把node添加的环境变量即可解决。②express 4.x版本中将命令工具分出来了，需要再安装一个命令工具，执行命令“npm install -g express-generator”完成后再测试就可以了。</p>
</li>
</ol>
<p>三，    创建工程<br>1，express nohare</p>
<p>2,打开package.json文件，右面添加下面红字内容，注意红字前一项的最后要加逗号，<br> “dependencies”: {<br>    “body-parser”: “~1.17.1”,<br>    “cookie-parser”: “~1.4.3”,<br>    “debug”: “~2.6.3”,<br>    “express”: “~4.15.2”,<br>    “jade”: “~1.11.0”,<br>    “morgan”: “~1.8.1”,<br>    “serve-favicon”: “~2.4.2”,<br>    “mongodb”: “<em>“,<br>    “monk”: “</em>“</p>
<p>四，mongod操做</p>
<p>下载mongoDB，然后在环境变量里面把path加上mongoDB的bin的path</p>
<p>1,在F:\nodejs\nohare目录下面启动npm start<br>DB连接并且启动服务：mongod -dbpath  F:\nodejs\nohare\data<br>在浏览器里面打开 <a href="http://localhost:3000/helloworld" target="_blank" rel="noopener">http://localhost:3000/helloworld</a></p>
<p>use admin<br>db.createUser(<br>  {<br>    user: “userAdmin”, //用户名<br>    pwd: “123”, //密码<br>    roles: [ { role: “userAdminAnyDatabase”, db: “admin” } ] //权限<br>  }<br>)</p>
<p>use yesdb<br>db.createUser(<br>  {<br>    user: “admin”, //用户名<br>    pwd: “123456”, //密码<br>    roles: [ { role: “userAdminAnyDatabase”, db: “ yesdb “ } ] //权限<br>  }<br>)</p>
<p> Mongod –auth –dbpath data</p>
<p>use yesdb<br>db.createUser(<br>  {<br>    user: “tester”,<br>    pwd: “123”,<br>    roles: [ { role: “readWrite”, db: “yesdb” },<br>             { role: “read”, db: “reporting” } ]<br>  }<br>)</p>
<p>2，mongoDb的可视化工具：<a href="https://robomongo.org/download" target="_blank" rel="noopener">https://robomongo.org/download</a><br>使用方法：<a href="http://www.jianshu.com/p/1a2032cfa13d" target="_blank" rel="noopener">http://www.jianshu.com/p/1a2032cfa13d</a></p>
<p>insertDocument:<br>{<br>    “_id” : ObjectId(“5202b481d2184d390cbf6eca”),<br>    “username” : “testuser1”,<br>    “email” : “<a href="mailto:testuser1@testdomain.com" target="_blank" rel="noopener">testuser1@testdomain.com</a>“<br>}</p>
<p>res.render(‘salescontract’,<br>render后面的是对应的ejs的文件名称。</p>
<p>传参数获取参数值<br>req.query.id</p>
<p>3，db查找<br>db.users.find({}, {‘name’ : 1, ‘skills’ : 1});<br>说明： 第一个{} 放where条件 第二个{} 指定那些列显示和不显示 （0表示不显示 1表示显示)</p>
<p>重定向的时候，加上参数变量，下面id就是变量<br>res.redirect(“contractdetail?id=”+id);</p>
<p>res.send没有貌似return效果，如果不想继续执行的话，需要后面加上return；</p>
<p>五，一些方法<br>查询非阻塞的例子</p>
<h2 id="下面查找到以后，要进行计算以后再更新，，因为查找是非租塞的，所以更新必须放在查找的结果里面做，否则，更新前的计算总是不正确。"><a href="#下面查找到以后，要进行计算以后再更新，，因为查找是非租塞的，所以更新必须放在查找的结果里面做，否则，更新前的计算总是不正确。" class="headerlink" title="下面查找到以后，要进行计算以后再更新，，因为查找是非租塞的，所以更新必须放在查找的结果里面做，否则，更新前的计算总是不正确。"></a>下面查找到以后，要进行计算以后再更新，，因为查找是非租塞的，所以更新必须放在查找的结果里面做，否则，更新前的计算总是不正确。</h2><p>sales.find({“ctrctId” : id},{},function(e,docs){<br>        gathertotalvalue = parseInt(docs[0].gathertotalvalue);<br>        gathertotalratio = parseInt(docs[0].gathertotalratio);<br>        gathertotalvalue = 10;</p>
<pre><code>    // update to the DB
    sales.update({&quot;ctrctId&quot; : id}, 
        {$push:{&quot;gather&quot;:{
                &quot;gathervalue&quot;:gathervalue,
                &quot;gatherratio&quot;:gatherratio,
                &quot;gathertime&quot;:gathertime,
            }}},
        function (err, doc) {
        if (err) {
            // If it failed, return error
            res.send(&quot;There was a problem adding the information to the database.&quot;);
            return;
        }
        else {

        }
    });

    gathertotalvalue = parseInt(gathervalue) + gathertotalvalue;
    gathertotalratio = parseInt(gatherratio) + gathertotalratio;

    //update   billtotalvalue  and billtotalratio tp db
    sales.update({&quot;ctrctId&quot; : id}, 
        {$set:{&quot;gathertotalvalue&quot;:gathertotalvalue,&quot;gathertotalratio&quot;:gathertotalratio}},
        function (err, doc) {
        if (err) {
            // If it failed, return error
            res.send(&quot;There was a problem adding the information to the database.&quot;);
            return;
        }
        else {
            // And forward to success page
            res.redirect(&quot;contractdetail?id=&quot;+id);
        }
    });

});
</code></pre><hr>
<p>table中放入元素时，必须是嵌套在tr的td标签中的， 否则布局会受影响</p>
<p>login保存在session里面</p>
<p>搜索需要正则表达式<br>var pattern = new RegExp(“^.<em>“+str+”.</em>$”);</p>
<p><input type="" required="required" name="" id="" value=""><br>加上required 这个属性 ，就成了必填字段 。</p>
<p>db.collections.find({‘$where’: “this.x &gt; this.y”}, {‘name’: 1})</p>
<p>中文字符转换，并且解决参数传递乱码问题,并且防止非法字符（&amp;）等：<br>传递前参数前面加上函数encodeURIComponent（），<br>解码的时候：decodeURIComponent（）</p>
<p>文件上传<br>Npm install connect-multiparty</p>
<p>//form表单需要的中间件。<br>var mutipart= require(‘connect-multiparty’);</p>
<p>var mutipartMiddeware = mutipart();</p>
<p>npm install node-xlsx</p>
<p>xls转json(解析XLS文件)<br>var xlsx = require(“node-xlsx”);<br>var fs = require(‘fs’);<br>var list = xlsx.parse(“Camp.xlsx”);<br>//console.log(JSON.stringify(list));<br>这个list其实是数组，数组的使用方法：<br>function praseExcel(list)<br>{<br>    console.log(“qqq”);<br>    for (var i = 0; i &lt; list.length; i++)<br>    {<br>         var excleData = list[i].data;<br>         var sheetArray  = [];<br>         var typeArray =  excleData[1];<br>         var keyArray =  excleData[2];<br>        for (var j = 3; j &lt; excleData.length ; j++)<br>        {<br>             var curData = excleData[j];<br>             if(curData.length == 0) continue;<br>             var item = changeObj(curData,typeArray,keyArray);<br>             sheetArray.push(item);<br>        }<br>        if(sheetArray.length &gt;0)<br>        writeFile(list[i].name+”.json”,JSON.stringify(sheetArray));<br>    }<br>   console.log(“qqq”);<br>}</p>
<p>上传文件参考：<br><a href="http://developer.51cto.com/art/201611/520835.htm?pc" target="_blank" rel="noopener">http://developer.51cto.com/art/201611/520835.htm?pc</a></p>
<p>日期格式转换：<br>npm install moment –save<br>var date = new Date(1900, 0, list[0].data[i][4]-1);<br>var date1=moment(date).format(“YYYY/MM/DD”);<br>console.log(date1);</p>
<p>pushAll的时候，后面条件用数组[]。而不需要用数组转换以后的Json格式。</p>
<p>查询里面的某一个数组<br>sales.find({“attach.filename” : name},{“attach.originalname.$”:1},function(e,docs){</p>
<p>form表单里面有file的时候，必须要有enctype=”multipart/form-data”这个选项，如果没有file的时候，则不需要，否则可能出错</p>
<p>删除按钮的实现</p>
<p><form name="form1" method="post" action="xxx.htm" onsubmit="javascript:return window.confirm('确认提交吗？')"><br>                    <input type="submit" value="删除"></form></p>
<p>更新时候，更新某个具体的数组的操作，用到￥<br>var sales = db.get(‘salescontract’);<br>    sales.update({“ctrctId” : ctrctId,”purchase.purchsId”:purchsId},<br>        {$set:{<br>            “purchase.$.purchsValue” : purchsValue,<br>            “purchase.$.purchsTime” : purchsTime,<br>            “purchase.$.purchsBrief” : purchsBrief,<br>            }},<br>         function (err, doc) {<br>            if (err) {<br>                // If it failed, return error<br>                res.send(“There was a problem update the information to the database  bb.”);<br>                return;<br>            }<br>            else {<br>                // And forward to success page<br>                res.redirect(“contractdetail?id=”+ctrctId);<br>            }<br>        });</p>
<p>变更数组的时候，要指定哪一个。<br>比如 下面的0<br>{$set:{<br>                        “sales.0.ctrctBrief”:ctrctBrief,<br>                    }}</p>
<p>如果变更不存在，增加一个的话就用upset<br>purchase.update({“purchsId” : docs[0].purchase[i].purchsId},<br>                    {$set:{<br>                        “sales.0.ctrctBrief”:ctrctBrief,<br>                    }},{upsert: true},<br>                    function(error, result){<br>                    if (error) {<br>                      console.log(‘update salse and purchase Error:’+ error);<br>                    }else{<br>                    }<br>                });</p>
<p>函数传递参数的时候，参数后面如果有空格的话，会丢掉，导致传递的参数和以前的值不一致，一个有空格，一个没有空格，为了避免这种情况一开始得到值的时候，就把后面的空格去掉，用replace函数。<br>var purchsId = purchsId1.replace(/(^\s<em>)|(\s</em>$)/g, “”);</p>
<p>MongoDB想用动态变量下标来删除或更新数组的时候，基本上不可能，可以用该动态变量下标，来查找到这个数组的所有内容，然后用所有内容作为关键字，来进行变更和删除</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/07/08/-nodejs随笔/" data-id="cjlwaougl000jbccc7x1jddem" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs-express-mongodb/">nodejs express mongodb</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-构建网站" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/12/26/构建网站/" class="article-date">
  <time datetime="2014-12-26T13:53:16.000Z" itemprop="datePublished">2014-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/26/构建网站/">构建网站感想</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1，从头一点点弄个小网站也很不是很容易的。<br>2，这次构建过程中，发生很多问题，这才发现前段时间我弄的google翻墙起了大作用，<br>   解决大部分的问题。<br>3，域名还是要货比三家，国内的一个.me域名一年居然要200人民币，简直抢钱，<br>   还是国外的godaddy比较便宜，找个优惠券才50几块钱。</p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/12/26/构建网站/" data-id="cjlwaoud70005bcccbf2zi1qe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/感想/">感想</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网站/">网站</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-开始" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/12/26/开始/" class="article-date">
  <time datetime="2014-12-26T13:53:16.000Z" itemprop="datePublished">2014-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/26/开始/">开始&amp;sublimeText</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天第一次用hexo来制作博客，感觉非常的好。<br>并且使用了sublime Text这款编辑器，感觉很帅，并且觉得逼格高了一大块。<br>安装插件具体如下<br>1.直接安装<br>安装Sublime text 2插件很方便，可以直接下载安装包解压缩到Packages目录（菜单-&gt;preferences-&gt;Browser Packages..）。</p>
<p>2.使用Package Control组件安装<br>也可以安装package control组件，然后直接在线安装：</p>
<p>按Ctrl+`调出console，粘贴以下代码到底部命令行并回车：<br>import urllib2,os;pf=’Package Control.sublime-package’;ipp=sublime.installed_packages_path();os.makedirs(ipp) if not os.path.exists(ipp) else None;open(os.path.join(ipp,pf),’wb’).write(urllib2.urlopen(‘<a href="http://sublime.wbond.net/&#39;+pf.replace" target="_blank" rel="noopener">http://sublime.wbond.net/&#39;+pf.replace</a>(‘ ‘,’%20’)).read())<br>然后重启Sublime Text 2。<br>如果在Perferences中看到package control这一项，则安装成功。<br>如果这种方法不能安装成功，可以参考<a href="https://sublime.wbond.net/installation" target="_blank" rel="noopener">https://sublime.wbond.net/installation</a></p>
<p>用Package Control安装插件的方法：<br>点击package Control，然后找到【Package Control: Install Package】，输入你想要的package的名称即可。</p>
<p>今天用hexo deploy穿文件去git上面，总是错误。<br>后来把nodejs下面的的.deploy删除就好了，参考的是<a href="http://blog.fens.me/hexo-blog-github/文章。" target="_blank" rel="noopener">http://blog.fens.me/hexo-blog-github/文章。</a></p>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/12/26/开始/" data-id="cjlwaougo000kbccc5ao9oraw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sublime-Text/">sublime Text</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/开始/">开始</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monk/">Monk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c-c-c/">c,c++,c#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dll/">dll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs-express-mongodb/">nodejs express mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime-Text/">sublime Text</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/传感器/">传感器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开始/">开始</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感想/">感想</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序/">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站/">网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/问题/">问题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目/">项目</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Monk/" style="font-size: 10px;">Monk</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/c-c-c/" style="font-size: 10px;">c,c++,c#</a> <a href="/tags/dll/" style="font-size: 10px;">dll</a> <a href="/tags/nodejs-express-mongodb/" style="font-size: 10px;">nodejs express mongodb</a> <a href="/tags/sublime-Text/" style="font-size: 10px;">sublime Text</a> <a href="/tags/传感器/" style="font-size: 10px;">传感器</a> <a href="/tags/开始/" style="font-size: 10px;">开始</a> <a href="/tags/感想/" style="font-size: 10px;">感想</a> <a href="/tags/排序/" style="font-size: 10px;">排序</a> <a href="/tags/网站/" style="font-size: 10px;">网站</a> <a href="/tags/问题/" style="font-size: 10px;">问题</a> <a href="/tags/项目/" style="font-size: 10px;">项目</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/12/02/for_each和函数对象/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/09/10/C#调用 C和C++dll的方法/">C#调用 C/C++dll的方法：</a>
          </li>
        
          <li>
            <a href="/2018/09/10/传感器/">传感器的考虑</a>
          </li>
        
          <li>
            <a href="/2018/09/06/项目问题总结/">项目问题总结</a>
          </li>
        
          <li>
            <a href="/2018/07/10/排序/">monogodb 排序</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Hou dejun<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>